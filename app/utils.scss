@use "sass:color";
@use "sass:list";
@use "sass:map";
@use "sass:math";
@use "sass:meta";

$breakpoints: (
  phone: 0,
  tablet: 37.5,
  laptop: 56.25,
  desktop: 75
);

@mixin with-breakpoint($breakpoint) {
  $width: map.get($breakpoints, $breakpoint);

  @if $width > 0 {
    @media (min-width: #{$width}rem) {
      @content
    }
  } @else {
    @content
  }
}

@function generate-shades($start, $end, $shades) {
  $result: ();
  $length: list.length($shades);
  $min: math.min($shades...);
  $max: math.max($shades...);

  @each $shade in $shades {
    $weight: if($length > 1, math.percentage((($shade - $max) * math.div(1, $min - $max))), 0%);
    $result: map.set($result, $shade, color.mix($start, $end, $weight));
  }

  @return $result;
}

@function generate-palette($colors) {
  $result: ();

  @each $color, $config in $colors {
    $colors: map.get($config, colors);
    $shades: map.get($config, shades);
    $result: map.set($result, $color, generate-shades(list.nth($colors, 1), list.nth($colors, 2), $shades));
  }

  @return $result;
}

$palette: generate-palette((
  gray: (
    colors: #ffffff #454545,
    shades: 0 100 200 300 400 500
  ),
  green: (
    colors: #1ed760 #1ed760,
    shades: 200
  )
));

$tokens: (
  background: (
    light: gray 0,
    dark: gray 500
  ),
  on-background: (
    light: gray 500,
    dark: gray 0
  ),
  accent: green 200,
  on-accent: gray 500,
  surface: (
    light: gray 100,
    dark: gray 400
  ),
  on-surface: on-background
);

@function get-color($token, $theme) {
  $colors: map.get($tokens, $token);
  $color: if(meta.type-of($colors) == 'map', map.get($colors, $theme), $colors);

  @if meta.type-of($color) == 'string' {
    $color: get-color($color, $theme);
  }

  @return $color;
}

@mixin with-colors($theme) {
  @each $token in map.keys($tokens) {
    $color: get-color($token, $theme);

    --#{$token}: #{map.get(map.get($palette, list.nth($color, 1)), list.nth($color, 2))};
  }
}
